post:
  summary: Auth device
  description: >
    Authentic a device.

    `X-Real-IP` header is used to set a geolocation position to device when
    `geoip` feature is enable.

    Every 30 seconds, this route is hit by internal ShellHub to check device
    availability.
  tags:
    - device
  security:
    - Auth: []
  parameters:
    - name: X-Real-IP
      schema:
        description: Device's IP
        type: string
        pattern: ^[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}$
        example: 127.0.0.1
      in: header
  requestBody:
    content:
      application/json:
        schema:
          type: object
          properties:
            info:
              type: object
              properties:
                id:
                  description: Device's OS name
                  type: string
                  example: example
                pretty_name:
                  description: Device's OS pretty name
                  type: string
                  example: linux
                version:
                  description: Device's OS version
                  type: string
                  example: latest
                arch:
                  description: Device's OS arch
                  type: string
                  # TODO: add more compatible arches.
                  enum:
                    - x86_64
                    - amd64
                    - arm64
                  example: x86_64
                platform:
                  description: Device's OS platform
                  type: string
                  # TODO: What are valid platforms?
                  example: docker
            sessions:
              # TODO: What is a session?
              # TODO: Add description and more information.
              type: array
              items:
                type: string
            hostname:
              type: string
              # TODO: add an example.
              pattern: ([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]*[a-zA-Z0-9])\.)*
            identity:
              description: Device's identity
              type: object
              properties:
                mac:
                  description: Device's MAC
                  type: string
                  example: 00:00:00:00:00:00
                  pattern: ^([0-9A-Fa-f]{2}[:-]){5}([0-9A-Fa-f]{2})$
            public_key:
              description: Device's public key
              type: string
              example: -----BEGIN PUBLIC KEY-----\nAAAAB3NzaC1yc2EAAAADAQABAAABAQCpGJLEIHeai6JvKt5/cJ1Z+g9ntvnRIwbTW2NL6ceLcaV37r/bQkWqF3jQcaE6chLn/JHonteC/FFCp+HaXrmzL4/z03aK4KJ/Tplap1+OC+J6CClnx1Pjx7prJXeJbvb2iGgIhcXqJ9QNCNbRdYkSeGAR/8mMwG5nhkPU/ToPgsGbvCrEXRv5HvXKR/UZVps98uJ9j7dfjtRoPG4r5QDin4tHx7bLirmpuv5+7T9wSRwlUrxmPDHcsud1naaOQmw8pOb2f/5enjRx80INLt6riMSDYitdo+IVy0VUFnzWFP4SgnoZGaSxyAdd5BvoXuFN2xrwPl4/rB521hRTPM/j\n-----END PUBLIC KEY-----\n
            tenant_id:
              description: Device's namespace tenant
              type: string
              example: 3dd0d1f8-8246-4519-b11a-a3dd33717f65
              pattern: ^[0-9a-fA-F]{8}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{12}$
          required:
            - info
            - session
            - hostname
            - public_key
            - tenant_id
  responses:
    '200':
      description: Success to auth device
      content:
        application/json:
          schema:
            type: object
            properties:
              uid:
                description: Device's UID
                type: string
                pattern: ^[0-9a-fA-F]{64}$
                example: 13b0c8ea878e61ff849db69461795006a9594c8f6a6390ce0000100b0c9d7d0a
              token:
                # TODO: improve description
                description: Device's token
                type: string
                example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.iUCROHt6JHANdtzT6aOuUgOqVFRalOW20SbzRsn5SkI
              name:
                description: |
                  Device's name
                  
                  
                  By default, the name is the device's MAC address when it just added.
                type: string
                example: example
              namespace:
                description: Device's namespace name
                type: string
                example: examplespace
    '401':
      $ref: ../../shared/responses/unauthorized.yaml
    '500':
      $ref: ../../shared/responses/any_internal_error.yaml
