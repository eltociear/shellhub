post:
  operationId: postAuthDevice
  summary: Auth device
  description: |
    Auth a device.
    
    Every 30 seconds, this route is hit by internal ShellHub to check device
    availability.
  tags:
    - devices
  security:
    - Auth: []
  parameters:
    - name: X-Real-IP
      schema:
        description: |
          Device's IP address.
          
          
          `X-Real-IP` header is used to set a geolocation position to device when
          `geoip` feature is enable.
        type: string
        pattern: ^[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}$
        example: 127.0.0.1
      in: header
  requestBody:
    content:
      application/json:
        schema:
          type: object
          properties:
            info:
              $ref: ../components/schemas/deviceInfo.yaml
            sessions:
              type: array
              items:
                # What is session?
                type: string
            hostname:
              type: string
              pattern: ([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]*[a-zA-Z0-9])\.)*
              # Add example to hostname.
            identity:
              $ref: ../components/schemas/deviceIdentity.yaml
            public_key:
              $ref: ../components/schemas/publicKey.yaml
            tenant_id:
              $ref: ../components/schemas/tenantID.yaml
          required:
            - info
            - session
            - hostname
            - public_key
            - tenant_id
  responses:
    '200':
      description: Success to auth device
      content:
        application/json:
          schema:
            type: object
            properties:
              uid:
                description: Device's UID
                type: string
                pattern: ^[0-9a-fA-F]{64}$
                example: |
                  13b0c8ea878e61ff849db69461795006a9594c8f6a6390ce0000100b0c9d7d0a
              token:
                description: Device's token
                type: string
                example: |
                  eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.iUCROHt6JHANdtzT6aOuUgOqVFRalOW20SbzRsn5SkI
              name:
                description: |
                  Device's name



                  By default, the name is the device's MAC address when it just
                  added.
                type: string
                example: example
              namespace:
                description: Device's namespace name
                type: string
                example: examplespace
    '401':
      $ref: ../components/responses/unauthorized.yaml
    '500':
      $ref: ../components/responses/internalError.yaml
